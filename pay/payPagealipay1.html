<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="keywords" content="宁波飞扬旅行社,宁波旅行社,宁波旅游网" />
    <meta name="description" content="飞扬旅游网隶属于浙江飞扬国际旅游集团,宁波旅行社行业第一,全国第八,浙江省首批五星级旅行社,宁波市最佳旅行社.服务热线:4000-365-666" />
    <meta name="apple-mobile-web-app-title" content="飞扬旅游网" />
    <title>飞扬旅游网</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/my-app.css">
</head>
<body class="grayBg" ontouchstart>
    <div class="views" id="loadDiv" style="display:none;">
        <!--view-main start-->
        <div class="view view-main">
            <!--page start-->
            <div class="page">
                <!--page-content start-->
                <div class="page-content white">
                    <div class="loadingRow" style="background:#66cbff"><img style="margin-top:-20%;" src="../images/loading-ani.gif" alt=""></div>
                </div>
                <!--page-content END-->
            </div>
            <!-- page END-->

        </div>
        <!--view-main END-->
    </div>

    <!--views start-->
    <div class="views" id="contentDiv">
        <!--view-main start-->
        <div class="view view-main">
            <!--page start-->
            <div class="page navbar-fixed">
                <!-- navbar start-->
                <div class="navbar tmBar">
                    <div class="navbar-inner navbar-on-center">
                        <div class="left"><a class="back link" href="javascript:goBack();"> <i class="icon icon-back"></i></a></div>
                        <div class="center sliding t1">支付订单</div>
                        <div class="right"></div>
                    </div>
                </div>
                <!-- navbar END-->
                <!--page-content start-->
                <div class="page-content">
                    <div class="w-panel card-spe">
                        <ul class="list-b ft14">
                            <li>
                                <div class="ft16" id="proTitle">

                                </div>
                            </li>
                            <li>
                                <div class="color6 ft16" id="orderNo"></div>
                            </li>
                            <li>
                                <div class="color6 ft16" id="orderStatus"></div>
                            </li>
                            <li>
                                <div class="color6 ft16" id="startTime"></div>
                            </li>
                            <li>
                                <div class="color6 ft16" id="person"></div>
                            </li>
                            <li>
                                <div class="color6 ft16" id="allPrice"></div>
                            </li>
                        </ul>
                    </div>
                    <div class="w-panel p0" id="paySel">
                        <div class="card-header">支付金额比例选择</div>
                        <div class="row per">
                            <!--<div class="col-33"><a class="active" href="javascript:selPayNum(1,0.3);" name="payNum" id="pay1">支付30%</a></div>
                            <div class="col-33"><a href="javascript:selPayNum(2,0.5);" name="payNum" id="pay2">支付50%</a></div>-->
                            <div class="col-33"><a href="javascript:selPayNum(3,1);" name="payNum" id="pay3">全额支付</a></div>
                        </div>
                    </div>
                    <div class="w-panel p0">
                        <div class="card-header">支付方式选择</div>
                        <ul class="payment">
                            <li>
                                <label class="label-radio item-content">
                                    <input type="radio" value="" name="radio" checked>
                                    <div class="item-media"><i class="icon icon-form-radio"></i></div>
                                    <div class="item-inner">
                                        <div class="item-title">支付宝</div>
                                    </div>
                                </label>
                            </li>
                        </ul>
                    </div>
                    <div class="w-panel p0">
                        <!--<div class="card-header">费用明细</div>
                        <ul class="list-b ft15">
                            <li id="teamPriceStr">
                            </li>
                            <li id="insList">
                                <div class=" mb5 clerFix"><b class="floatL">保险费用</b><font class="floatR pinkTxt">¥120</font></div>
                                <p class="color6">泰康境外旅意险(户外运动版)</p>
                            </li>
                            <li>
                                <div class="mb5 clerFix"><b class="floatL">优惠</b><font class="floatR greenTxt">－¥60</font></div>
                                <p class="color6">下单立减</p>
                                <div class="color6"><span class="floatL">2成人</span><span class="floatR">¥30×2</span></div>
                            </li>
                            <li>
                                <div class="algin_right ft18 pinkTxt">总计：17860</div>
                            </li>
                        </ul>-->
                        <div class="row_price ft16" id="payDiv">
                            <form name="myForm" id="myForm" method="post" action="http://pay.iflying.com/alipay/wap/SendNew.aspx">
                                <input type="hidden" id="myorderId" name="orderId" value="" />
                                <input type="hidden" id="orderFromId" name="orderFromId" value="5" />
                                <input type="hidden" id="payTypeId" name="payTypeId" value="9" />
                                <input type="hidden" id="orderType" name="orderType" value="0" />
                                <input type="hidden" id="unpaid" name="unpaid" value="" />
                                <input type="hidden" id="prepay" name="prepay" value="" />
                                <input type="hidden" id="totalPay" name="totalPay" value="" />
                                <input type="hidden" id="title" name="title" value="" />
                                <input type="hidden" id="actionType" value="2" />
                                <input type="hidden" id="orderAmount" name="orderAmount" value="0" />
                            </form>
                                <span class="pt10 floatL">支付金额：<font class="pinkTxt ft18" id="payMoney"></font></span><span class="floatR">
                                    <a href="javascript:subPay();" class="button button-big button-fill inline redBtn radis0 inline mBtn">确认支付</a>
                                </span>
                                
                        </div>
                    </div>
                    <div class="space">&nbsp;</div>
                </div>
                <!--page-content END-->
            </div>
            <!-- page END-->
        </div>
        <!--view-main END-->
    </div>
    <!-- views end-->                                                                                                                                 

    <script type="text/javascript" src="../js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="../js/command.js"></script>
    <script type="text/javascript">
        var myRequest = GetRequest();
        var orderId = decodeURI(myRequest["order"]);
        if (orderId == undefined || orderId == null || orderId == "") {
            alert("参数错误!");
            window.location.href = "http://m.iflying.com/";
        }
        var unpayprice = 0;
        var payprice = 0;
        var postJson;
        function goBack() {
            window.location.href = "../OrderPublic/orderDetail.html?order=" + orderId;
        }
        function loadInfo() {
            $.getJSON(orderdetailUrl + "&OrderID=" + orderId, function (data) {
                if (data != null && data.data != null) {
                    if (data.data.OrderInfo.length > 0) {
                        var orderItem = data.data.OrderInfo[0];
                        postJson = orderItem;
                        var orderStatus = orderItem.Status;
                        var statusStr = "";
                        if (orderStatus < 0) {
                            statusStr = "<font class='red_t'>已取消</font>";
                            $("#payDiv").hide();
                        }
                        else if (orderStatus == 0) {
                            statusStr = "<font class='red_t'>待处理</font>";
                        }
                        else if (orderStatus == 1) {
                            statusStr = "<font style='color:green;'>已签约</font>";
                        }
                        $("#orderStatus").html("订单状态：" + statusStr);
                        $("#proTitle").html(orderItem.PBASTitle);
                        $("#orderNo").html("订单编号：" + orderItem.OrderNo);
                        $("#startTime").html("发团日期：" + orderItem.ProductStartTime);
                        $("#orderTime").html("下单时间：" + orderItem.CreateTime);
                        var perStr = "";
                        if (orderItem.AdultCount > 0) {
                            perStr += orderItem.AdultCount + "成人";
                        }
                        if (orderItem.ChildCount > 0) {
                            perStr += orderItem.ChildCount + "小孩";
                        }
                        $("#person").html("出游人数：" + perStr);
                        var priceStr = "订单总额：<font class='red_t'>¥" + orderItem.TotalMoney + "</font>";
                        if (orderItem.Prepay > 0) {
                            priceStr += "&nbsp;&nbsp;已支付：<font style='color:green;font-size:14px;'>¥" + orderItem.Prepay + "</font>";
                        }
                        $("#allPrice").html(priceStr);
                        unpayprice = orderItem.Unpaid;
                        //if (orderItem.Prepay > 0) {
                            $("#paySel").hide();
                            $("#payMoney").html("¥" + orderItem.Unpaid);
                            payprice = orderItem.Unpaid;                               
                        //}
                        //else {
                        //    payprice = orderItem.Unpaid * 0.3;
                        //    payprice = parseInt(payprice, 10);
                        //    $("#payMoney").html("¥" + payprice);
                        //}
                    }
                    $("#myorderId").val(orderId);
                    $("#unpaid").val(orderItem.Unpaid);
                    $("#prepay").val(orderItem.Prepay);
                    $("#totalPay").val(orderItem.TotalMoney);
                    $("#title").val(orderItem.PBASTitle);
                    //var insStr = "";
                    //if (data.data.InsuranceList != null && data.data.InsuranceList.length > 0) {
                    //    insStr += "<div class='mb5 clerFix'><b class='floatL'>保险费用</b><font class='floatR pinkTxt'>¥" + data.data.InsuranceTotalMoney + "</font></div>";
                    //    $.each(data.data.InsuranceList, function (i, item) {
                    //        insStr += "<p class='color6'>" + item.ProductInsurance.ProductInsuranceName + "</p>";
                    //    });                        
                    //}
                    //if (insStr != "") {
                    //    $("#insList").html(insStr);
                    //    $("#insList").show();
                    //}
                    //else {
                    //    $("#insList").hide();
                    //}
                }
            });
        }
        loadInfo();
        var payPostJson;
        function subPay() {
            if (payprice > 0) {
                $("#orderAmount").val(payprice);
                $("#loadDiv").show();
                $("#contentDiv").hide();

                document.forms[0].submit();
            }
        }
        function selPayNum(obj, num) {
            $("[name='payNum']").each(function () {
                $(this).removeClass("active");
            });
            $("#pay"+obj).addClass("active");
            payprice = unpayprice * num;
            payprice = parseInt(payprice, 10);
            payprice = 0.1;
            $("#payMoney").html("¥" + payprice);
        }
    </script>
</body>
</html>